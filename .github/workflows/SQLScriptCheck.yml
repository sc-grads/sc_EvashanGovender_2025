name: SQL Syntax Check

on:
  push:
    paths:
      - '**.sql'
  pull_request:
    paths:
      - '**.sql'

jobs:
  check-sql:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Start MySQL
        run: |
          docker run --name mysql-container -e MYSQL_ROOT_PASSWORD=root -d mysql:latest
          sleep 10

      - name: Debug SQL Files
        run: find . -type f -name "*.sql"

      - name: Validate SQL scripts
        run: |
          export MYSQL_PWD=root
          for file in $(find . -type f -name "*.sql"); do
            echo "Checking $file"
            docker exec -i mysql-container mysql -uroot -e "source $file"
          done

      - name: Stop MySQL
        if: always()
        run: docker stop mysql-container

